const Discord = require("discord.js")

module.exports = {
    name: "jail",
    aliases: ["prison"],
    category: "moderation",
    description: "Emprisonner temporairement un utilisateur",
    usage: "<utilisateur> <temps(s/m/h)> [raison]",
    run: async (client, message, args) => {
        var tmReason = args.slice(3).join(' ')
        if (!message.member.hasPermission("MANAGE_MESSAGES")) return message.channel.send("> Vous n'avez pas la permission")
        var membre = message.guild.member(message.mentions.users.first() || message.guild.members.get(args[0]));
        if (!membre) return message.channel.send("> Vous devez mentionner un utilisateur")
        if (membre.highestRole.calculatedPosition >= message.member.highestRole.calculatedPosition && message.author.id !== message.guild.owner.id) return message.channel.send("> Vous ne pouvez pas mute cet utilisateur !")

        var pRole = message.guild.roles.find("name", "Jailed")
        if (!pRole) return message.channel.send("> Le rÃ´le **Jailed** n'Ã©xiste pas !")

        var pTime = args[2]; 
        if(!pTime) return message.channel.send("> DÃ©solÃ©, vous devez dÃ©finir un temps.")
        if (pRole) {
            if (!tmReason) return tmReason = "Aucune raison dÃ©finit"
            membre.addRole(pRole);
            message.channel.send(`> **${membre}** a Ã©tÃ© mis en prison pendant **${pTime}** pour **__${tmReason}__** :white_check_mark:`) 
            membre.send(`> ðŸ”’ Vous avez Ã©tÃ© mis en prison pendant **${pTime}** pour __**${tmReason}**__ ðŸ”’`)
            setTimeout(function () {
                membre.removeRole(pRole);
                message.channel.send(`**${membre}** n'est plus en prison ! :white_check_mark: !`)
            }, ms(pTime));
            let embed = new Discord.RichEmbed()
             .setColor('RED')
             .setTitle(`JAIL`)
             .setAuthor(client.user.tag, client.user.displayAvatarURL)
             .setThumbnail(membre.user.displayAvatarURL)
             .setDescription(membre.user.username + ` a Ã©tÃ© mis en prison!`)
             .addField(`ðŸ“Œ ModÃ©rateur: `, message.author.tag)
             .addField('ðŸ“„ Raison :', tmReason)
             .setFooter(`Log ModÃ©ration  || Limen by Sckz`)
             .setTimestamp()
        }
        else {
            message.guild.createRole({name: 'Jail', permissions: 0}).then((role) => {
                message.guild.channels.filter(channel => channel.type === 'text').forEach(channel => {
                    channel.overwritePermissions(role, {
                        SEND_MESSAGES: false
                    })
                })
                member.addRole(role)
            })
        }
    }
}